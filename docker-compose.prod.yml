# Docker Compose for production deployment
# Use this file with: docker compose -f docker-compose.prod.yml up -d
#
# For Portainer stack deployment, copy this content directly into the
# stack editor and configure environment variables in the Portainer UI.

services:
  pull-list:
    image: rhymeswithjazz/pull-list:${TAG:-latest}
    container_name: pull-list
    ports:
      - "8282:8000"
    environment:
      # User/Group IDs for permissions (match your NAS user)
      - PUID=${PUID:-1026}
      - PGID=${PGID:-100}
      # Mylar3 settings - update these for your network
      - MYLAR_URL=${MYLAR_URL:-http://mylar:8090}
      - MYLAR_API_KEY=${MYLAR_API_KEY}
      # Komga settings - update these for your network
      - KOMGA_URL=${KOMGA_URL:-http://komga:25600}
      - KOMGA_USERNAME=${KOMGA_USERNAME}
      - KOMGA_PASSWORD=${KOMGA_PASSWORD}
      - KOMGA_API_KEY=${KOMGA_API_KEY}
      # App settings
      - DATABASE_URL=sqlite+aiosqlite:///./data/pulllist.db
      - SECRET_KEY=${SECRET_KEY}
      - APP_URL=${APP_URL}
      # SMTP settings (for magic link authentication - leave empty to disable)
      - SMTP_HOST=${SMTP_HOST:-}
      - SMTP_PORT=${SMTP_PORT:-587}
      - SMTP_USERNAME=${SMTP_USERNAME:-}
      - SMTP_PASSWORD=${SMTP_PASSWORD:-}
      - SMTP_FROM_EMAIL=${SMTP_FROM_EMAIL:-}
      - SMTP_USE_TLS=${SMTP_USE_TLS:-true}
      # Schedule settings (daily by default, notifications sent once per week)
      - SCHEDULE_DAY_OF_WEEK=${SCHEDULE_DAY_OF_WEEK:-*}
      - SCHEDULE_HOUR=${SCHEDULE_HOUR:-10}
      - SCHEDULE_MINUTE=${SCHEDULE_MINUTE:-0}
      - TIMEZONE=${TIMEZONE:-America/New_York}
      # Notification settings (email when new comics available)
      - NOTIFICATION_EMAIL=${NOTIFICATION_EMAIL:-}
    volumes:
      - /volume1/docker/pull-list:/app/data
    networks:
      - comics
    restart: unless-stopped
    labels:
      # Optional: Traefik labels for reverse proxy
      # - "traefik.enable=true"
      # - "traefik.http.routers.pulllist.rule=Host(`pulllist.yourdomain.com`)"
      # - "traefik.http.services.pulllist.loadbalancer.server.port=8000"


networks:
  comics:
    external: true
    # If your Mylar and Komga are on a custom network, specify it here
    # Otherwise, remove the 'external: true' and let Docker create one
