<div id="book-{{ item.komga_book_id }}" class="cover-card bg-gray-800 rounded-lg overflow-hidden shadow-lg flex flex-col">
    <!-- Cover image -->
    <div class="relative aspect-[2/3] flex-shrink-0">
        {% if item.thumbnail_url %}
        <img
            src="{{ item.thumbnail_url }}"
            alt="{{ item.series_name }} #{{ item.book_number }}"
            class="w-full h-full object-cover"
            loading="lazy"
        >
        {% else %}
        <div class="w-full h-full bg-gray-700 flex items-center justify-center">
            <span class="text-4xl">ðŸ“•</span>
        </div>
        {% endif %}

        <!-- Status badges -->
        <div class="absolute top-2 right-2 flex flex-col gap-1">
            {% if item.is_read %}
            <span class="px-2 py-0.5 text-xs font-medium bg-green-600 text-white rounded-full">
                Read
            </span>
            {% elif item.read_percentage > 0 %}
            <span class="px-2 py-0.5 text-xs font-medium bg-purple-600 text-white rounded-full">
                {{ item.read_percentage }}%
            </span>
            {% elif item.is_downloaded %}
            <span class="px-2 py-0.5 text-xs font-medium bg-blue-600 text-white rounded-full">
                Unread
            </span>
            {% else %}
            <span class="px-2 py-0.5 text-xs font-medium bg-yellow-600 text-white rounded-full badge-pulse">
                Upcoming
            </span>
            {% endif %}
            <!-- One-off badge -->
            {% if item.is_one_off %}
            <span class="px-2 py-0.5 text-xs font-medium bg-purple-600 text-white rounded-full">One-Off</span>
            {% endif %}
        </div>

        <!-- Read progress bar -->
        {% if item.read_percentage > 0 and not item.is_read %}
        <div class="absolute bottom-0 left-0 right-0 h-1 bg-gray-900/50">
            <div class="h-full bg-purple-500" style="width: {{ item.read_percentage }}%"></div>
        </div>
        {% endif %}

        <!-- Release date for upcoming -->
        {% if item.release_date and not item.is_downloaded %}
        <div class="absolute bottom-2 left-2">
            <span class="px-2 py-0.5 text-xs bg-black/70 text-white rounded">
                {{ item.release_date }}
            </span>
        </div>
        {% endif %}
    </div>

    <!-- Info -->
    <div class="p-3 flex flex-col flex-grow">
        <h3 class="font-semibold text-sm text-white truncate" title="{{ item.series_name }}">
            {{ item.series_name }}
        </h3>
        <p class="text-xs text-gray-400 mt-0.5 line-clamp-2">
            #{{ item.book_number }}
            {% if item.book_title %} - {{ item.book_title }}{% endif %}
        </p>

        <!-- Spacer to push button to bottom -->
        <div class="flex-grow min-h-2"></div>

        <!-- Action buttons -->
        <div class="mt-2 flex gap-2">
            {% if item.read_url %}
            <a
                href="{{ item.read_url }}"
                target="_blank"
                class="flex-grow text-center px-3 py-1.5 text-sm font-medium bg-comic-yellow text-gray-900 rounded hover:bg-yellow-400 transition-colors"
            >
                Read Now
            </a>
            {% else %}
            <button
                disabled
                class="flex-grow text-center px-3 py-1.5 text-sm font-medium bg-gray-700 text-gray-500 rounded cursor-not-allowed"
            >
                Not Downloaded
            </button>
            {% endif %}

            <!-- Dropdown menu -->
            {% if item.is_downloaded %}
            <div class="relative" x-data="{ open: false }">
                <button
                    @click="open = !open"
                    @click.away="open = false"
                    class="px-2 py-1.5 text-sm font-medium bg-gray-700 text-white rounded hover:bg-gray-600 transition-colors"
                    aria-label="More actions"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M10 6a2 2 0 110-4 2 2 0 010 4zM10 12a2 2 0 110-4 2 2 0 010 4zM10 18a2 2 0 110-4 2 2 0 010 4z" />
                    </svg>
                </button>
                <div
                    x-show="open"
                    x-transition:enter="transition ease-out duration-100"
                    x-transition:enter-start="transform opacity-0 scale-95"
                    x-transition:enter-end="transform opacity-100 scale-100"
                    x-transition:leave="transition ease-in duration-75"
                    x-transition:leave-start="transform opacity-100 scale-100"
                    x-transition:leave-end="transform opacity-0 scale-95"
                    class="absolute right-0 bottom-full mb-1 w-36 bg-gray-700 rounded-md shadow-lg ring-1 ring-black ring-opacity-5 z-10"
                    style="display: none;"
                >
                    <div class="py-1">
                        <!-- Mark Read: disabled if already fully read -->
                        <button
                            {% if not item.is_read %}
                            hx-post="/api/book/{{ item.komga_book_id }}/mark-read"
                            hx-target="#book-{{ item.komga_book_id }}"
                            hx-swap="outerHTML"
                            @click="open = false"
                            class="w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-600 flex items-center gap-2"
                            {% else %}
                            disabled
                            class="w-full text-left px-4 py-2 text-sm text-gray-500 cursor-not-allowed flex items-center gap-2"
                            {% endif %}
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                            </svg>
                            Mark Read
                        </button>
                        <!-- Mark Unread: disabled if no reading progress -->
                        <button
                            {% if item.is_read or item.read_percentage > 0 %}
                            hx-post="/api/book/{{ item.komga_book_id }}/mark-unread"
                            hx-target="#book-{{ item.komga_book_id }}"
                            hx-swap="outerHTML"
                            @click="open = false"
                            class="w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-600 flex items-center gap-2"
                            {% else %}
                            disabled
                            class="w-full text-left px-4 py-2 text-sm text-gray-500 cursor-not-allowed flex items-center gap-2"
                            {% endif %}
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                            </svg>
                            Mark Unread
                        </button>
                        <a
                            href="/api/book/{{ item.komga_book_id }}/download"
                            @click="open = false"
                            class="w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-600 flex items-center gap-2"
                            download
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                            </svg>
                            Download
                        </a>
                        <!-- Promote to Tracked -->
                        {% if item.is_one_off %}
                        <button
                            hx-post="/api/book/{{ item.komga_book_id }}/promote-to-tracked"
                            hx-target="#book-{{ item.komga_book_id }}"
                            hx-swap="outerHTML"
                            @click="open = false"
                            class="w-full text-left px-4 py-2 text-sm text-gray-200 hover:bg-gray-600 flex items-center gap-2"
                        >
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18" />
                            </svg>
                            Add Series to Tracking
                        </button>
                        {% endif %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
